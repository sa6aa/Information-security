// assets/js/pentest.js
import './common.js';

// المراجع لعناصر الأزرار
const scanBtn = document.getElementById('scanBtn');
const testBtn = document.getElementById('testBtn');

// أداة فحص الرابط
scanBtn.addEventListener('click', () => {
  const url = document.getElementById('urlInput').value.trim();
  const resultP = document.getElementById('urlResult');
  if (url === '') {
    resultP.textContent = 'الرجاء إدخال رابط.';
    return;
  }
  let resText = '';
  const lowerUrl = url.toLowerCase();
  // فحص نوع البروتوكول (HTTP vs HTTPS)
  if (lowerUrl.startsWith('http://')) {
    resText += '⚠️ يستخدم الرابط بروتوكول HTTP غير الآمن. ';
  } else if (lowerUrl.startsWith('https://')) {
    resText += '✅ يستخدم الرابط بروتوكول HTTPS الآمن. ';
  } else {
    resText += '⚠️ الرابط المدخل غير قياسي (يُفضّل وجود http:// أو https://). ';
  }
  // فحص وجود javascript: في الرابط (مشبوه)
  if (lowerUrl.includes('javascript:')) {
    resText += '⚠️ يحتوي الرابط على "javascript:" وهو أمر مريب. ';
  }
  // فحص وجود رمز @ في الرابط (يُستغل أحيانًا في التصيّد)
  if (lowerUrl.includes('@')) {
    resText += '⚠️ يحتوي الرابط على "@" وقد يكون محاولة تصيّد. ';
  }
  if (resText === '') {
    resText = '✅ لم يتم العثور على مشاكل واضحة في الرابط.';
  }
  resultP.textContent = resText;
});

// أداة فحص المدخلات النصية
testBtn.addEventListener('click', () => {
  const inputText = document.getElementById('testInput').value;
  const resultP = document.getElementById('inputResult');
  if (inputText.trim() === '') {
    resultP.textContent = 'الرجاء إدخال نص للتحليل.';
    return;
  }
  let resText = '';
  const lowerInput = inputText.toLowerCase();
  // فحص وجود سكريبت (علامات XSS محتملة)
  if (lowerInput.includes('<script>')) {
    resText += '⚠️ تم الكشف عن وسم <script> – احتمال هجوم XSS. ';
  }
  // فحص نمطي لعبارات SQL الشائعة
  if (lowerInput.includes('select') && lowerInput.includes('from')) {
    resText += '⚠️ يحتوي الإدخال على جملة استعلام SQL (SELECT...FROM) – احتمال SQL Injection. ';
  }
  if (lowerInput.includes(' or ') && lowerInput.includes('=')) {
    resText += '⚠️ يحتوي الإدخال على مقارنة منطقية "OR" – احتمال SQL Injection. ';
  }
  if (resText === '') {
    resText = '✅ لم يتم اكتشاف ثغرات واضحة في الإدخال.';
  }
  resultP.textContent = resText;
});
